# AMA Archive System Requirements

## Purpose
Define the metadata handling and retention requirements for the AMA Archive System to ensure consistent capture, discovery, and lifecycle management of scanned materials.

## Metadata Model
| Field | Description | Type | Required | Source | Notes |
| --- | --- | --- | --- | --- | --- |
| `documentId` | Unique identifier assigned at ingestion | UUID string | Yes | Scanner job metadata | Generated by ingestion service |
| `title` | Human readable title of the document | String | Yes | Operator entry or OCR | Must be searchable; 5-255 chars |
| `description` | Summary of document contents | String | Optional | Operator entry | Supports markdown subset |
| `categories` | Topical labels for discovery | Array of strings | Optional | Operator tagging | Limited to predefined taxonomy |
| `tags` | Ad-hoc keywords | Array of strings | Optional | Operator tagging | Max 25 per document |
| `sourceType` | Origin classification (e.g., transcript, photo) | Enum | Yes | Operator selection | Controlled vocabulary |
| `scanDate` | Date the physical item was digitized | ISO 8601 date | Yes | Scanner timestamp | Default to ingestion date |
| `eventDate` | Date associated with the content | ISO 8601 date | Optional | Operator entry | Supports ranges via `eventDateEnd` |
| `eventDateEnd` | End of event date range | ISO 8601 date | Optional | Operator entry | Must be >= `eventDate` |
| `participants` | Key individuals featured | Array of strings | Optional | Operator tagging | Stored as normalized references |
| `rights` | Usage rights or licensing notes | String | Optional | Operator entry | Required for publication |
| `sensitivity` | Access classification (public, internal, restricted) | Enum | Yes | Operator selection | Drives retention and access |
| `retentionPolicy` | Identifier referencing retention schedule | Enum | Yes | Derived | Maps to policies below |
| `checksum` | Integrity hash of the binary | String | Yes | Ingestion service | SHA-256 |
| `fileSize` | Size of stored binary in bytes | Integer | Yes | Ingestion service | Validated against scanner output |
| `binaryLocation` | Pointer to stored binary (GridFS ID or path) | String | Yes | Ingestion service | Storage strategy dependent |
| `thumbnailLocation` | Pointer to derivative preview | String | Optional | Processing pipeline | Used by UI |
| `ocrText` | Extracted text for search | Text | Optional | OCR pipeline | Indexed for full-text search |
| `createdAt` | Timestamp when record entered system | ISO 8601 datetime | Yes | System generated | Immutable |
| `updatedAt` | Timestamp of last metadata change | ISO 8601 datetime | Yes | System generated | Auto-updated |
| `auditTrail` | Change history with actor/time | Array of objects | Yes | System generated | Append-only |
| `deletionMarker` | Flag for logical deletion | Boolean | Optional | System process | True when scheduled for purge |

## Metadata Validation Rules
- Mandatory fields are validated at API layer before persistence.
- Enum fields use centralized configuration managed by administrators.
- Text fields are sanitized for HTML/JS injection before storage.
- Arrays are deduplicated and trimmed during ingestion.
- `checksum` recalculated on re-upload to detect tampering.
- Audit trail captures user ID, action, timestamp, and diff summary.

## Retention Policies
| Policy ID | Description | Retention Duration | Trigger | Disposition |
| --- | --- | --- | --- | --- |
| `PERM_ARCHIVE` | Permanent archival of historically significant AMAs | Indefinite | Ingestion | Never purged; review every 5 years |
| `STD_10YR` | Standard retention for general AMA content | 10 years from `eventDate` or ingestion | EventDate or createdAt | Purge after automated review; notify owners 90 days prior |
| `SHORT_TERM` | Temporary holding for drafts or low-value scans | 2 years from ingestion | createdAt | Purge after manual approval |
| `LEGAL_HOLD` | Items under legal hold | Until hold released | Hold initiation | Purge prohibited until legal release |
| `CUSTOM` | Policy defined per record | As configured | Manual assignment | Requires explicit review date |

### Retention Controls
- Retention scheduler evaluates records nightly based on `retentionPolicy` and relevant dates.
- Records flagged for purge transition to `deletionMarker = true` and become inaccessible to standard users.
- Physical storage purge jobs remove binaries and thumbnails only after metadata and audit trail are exported for compliance.
- Legal hold overrides purge even if duration met.
- Administrative dashboard provides reports of upcoming purges with acknowledgment workflow.

## Compliance & Access
- Metadata and audit logs stored in MongoDB with replica set for durability.
- Sensitive records require role-based access controls aligning with `sensitivity` classification.
- System retains change history for minimum of 7 years regardless of retention policy to satisfy audit requirements.
- GDPR requests supported via lookup of `participants` or personal identifiers and manual review queue.

## Operational Requirements
- Ingestion API validates scanner inputs and rejects incomplete metadata.
- Background jobs regenerate thumbnails when storage strategy changes.
- Scheduled integrity checks recompute `checksum` monthly.
- Disaster recovery: nightly backups of metadata database and binary storage with 30-day retention.
